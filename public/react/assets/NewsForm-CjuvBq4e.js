import{r as n,c as J,b as Z,k as S,h as y,j as e,l as I,F as P}from"./index-DridtdXo.js";import{F as K}from"./ArrowLeftIcon-6Acp-hy-.js";import{F as Q}from"./PlusIcon-C57RYCdF.js";function X({title:g,titleId:x,...c},s){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":x},c),g?n.createElement("title",{id:x},g):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"}))}const Y=n.forwardRef(X),ee={title:"",title_ar:"",slug:"",excerpt:"",excerpt_ar:"",content:"",content_ar:"",featured_image:"",gallery_images:[],category:"",tags:"",is_published:!1,is_featured:!1,published_at:new Date().toISOString().split("T")[0],seo_title:"",seo_description:""},re=()=>{const g=J(),{id:x}=Z(),c=!!x,[s,p]=n.useState(ee),[A,N]=n.useState(!1),[v,w]=n.useState(!1),[o,d]=n.useState({}),[h,_]=n.useState(!1),[k,f]=n.useState(!1),O=n.useCallback(a=>{a.preventDefault(),a.stopPropagation(),f(!0)},[]),G=n.useCallback(a=>{a.preventDefault(),a.stopPropagation(),f(!1)},[]),$=n.useCallback(async a=>{a.preventDefault(),a.stopPropagation(),f(!1);const t=a.dataTransfer.files;t.length>0&&await C(t[0])},[]),U=async a=>{const t=a.target.files;t&&t.length>0&&await C(t[0])},C=async a=>{if(!a.type.startsWith("image/")){d(t=>({...t,featured_image:"Please select an image file"}));return}if(a.size>5*1024*1024){d(t=>({...t,featured_image:"Image must be less than 5MB"}));return}_(!0),d(t=>({...t,featured_image:""}));try{const t=await S.uploadImage(a,"news"),r=t.data?.data?.path||t.data?.path;if(r)p(l=>({...l,featured_image:r}));else throw new Error("No image path returned from server")}catch(t){console.error("Image upload error:",t);const r=t.response?.data?.message||t.message||"Failed to upload image";d(l=>({...l,featured_image:r}))}finally{_(!1)}},L=()=>{p(a=>({...a,featured_image:""}))},[b,D]=n.useState(!1),[F,j]=n.useState(!1),T=n.useCallback(a=>{a.preventDefault(),a.stopPropagation(),j(!0)},[]),M=n.useCallback(a=>{a.preventDefault(),a.stopPropagation(),j(!1)},[]),R=n.useCallback(async a=>{a.preventDefault(),a.stopPropagation(),j(!1);const t=Array.from(a.dataTransfer.files);await E(t)},[]),z=async a=>{const t=a.target.files;t&&t.length>0&&await E(Array.from(t)),a.target.value=""},E=async a=>{const t=a.filter(r=>r.type.startsWith("image/"));if(t.length===0){d(r=>({...r,gallery:"Please select image files"}));return}D(!0),d(r=>({...r,gallery:""}));try{const r=[];for(const l of t){if(l.size>5*1024*1024){console.warn(`Skipping ${l.name} - too large`);continue}const m=await S.uploadImage(l,"news"),u=m.data?.data?.path||m.data?.path;u&&r.push({image:u,isNew:!0})}p(l=>({...l,gallery_images:[...l.gallery_images,...r]}))}catch(r){console.error("Gallery upload error:",r),d(l=>({...l,gallery:"Failed to upload some images"}))}finally{D(!1)}},B=a=>{p(t=>({...t,gallery_images:t.gallery_images.filter((r,l)=>l!==a)}))};n.useEffect(()=>{c&&W()},[x]);const W=async()=>{N(!0);try{const a=await y.getOne(x),t=a.data?.data||a.data,r=(t.images||[]).map(l=>({id:l.id,image:l.image,isNew:!1}));p({title:t.title||"",title_ar:t.title_ar||"",slug:t.slug||"",excerpt:t.excerpt||"",excerpt_ar:t.excerpt_ar||"",content:t.content||"",content_ar:t.content_ar||"",featured_image:t.featured_image||"",gallery_images:r,category:t.category||"",tags:Array.isArray(t.tags)?t.tags.join(", "):t.tags||"",is_published:t.is_published||!1,is_featured:t.is_featured||!1,published_at:t.published_at?.split("T")[0]||new Date().toISOString().split("T")[0],seo_title:t.seo_title||"",seo_description:t.seo_description||""})}catch(a){console.error("Error fetching news:",a),alert("Failed to load the news article"),g("/admin/news")}finally{N(!1)}},i=a=>{const{name:t,value:r,type:l}=a.target,m=l==="checkbox"?a.target.checked:r;if(p(u=>({...u,[t]:m})),t==="title"&&!c){const u=r.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();p(V=>({...V,slug:u}))}o[t]&&d(u=>({...u,[t]:""}))},H=()=>{const a={};return s.title.trim()||(a.title="Title is required"),s.content.trim()||(a.content="Content is required"),d(a),Object.keys(a).length===0},q=async a=>{if(a.preventDefault(),!!H()){w(!0);try{const t={title:s.title,content:s.content};c&&s.slug&&(t.slug=s.slug),s.excerpt&&(t.excerpt=s.excerpt),s.featured_image&&(t.featured_image=s.featured_image),s.published_at&&(t.published_at=s.published_at),t.is_published=s.is_published,t.images=s.gallery_images.map(r=>r.image),c?await y.update(x,t):await y.create(t),g("/admin/news")}catch(t){if(console.error("Error saving news:",t),console.error("Error response:",t.response?.data),t.response?.data?.errors){const r={};Object.entries(t.response.data.errors).forEach(([l,m])=>{r[l]=Array.isArray(m)?m[0]:String(m)}),d(r)}else{const r=t.response?.data?.message||t.response?.data?.error||t.message||"Failed to save the article";alert(`Error: ${r}`)}}finally{w(!1)}}};return A?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-12 h-12 border-4 border-primary-600 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>g("/admin/news"),className:"p-2 text-neutral-500 hover:text-neutral-700 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded-lg transition-colors",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-900 dark:text-white",children:c?"Edit News":"Add News"}),e.jsx("p",{className:"text-neutral-500",children:c?"Update the news article":"Create a new news article"})]})]}),e.jsx("form",{onSubmit:q,className:"space-y-6",children:e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-xl shadow-soft p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-white mb-4",children:"English Content"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Title *"}),e.jsx("input",{type:"text",name:"title",value:s.title,onChange:i,className:`input ${o.title?"border-red-500":""}`,placeholder:"Enter article title"}),o.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Excerpt"}),e.jsx("textarea",{name:"excerpt",value:s.excerpt,onChange:i,rows:3,className:"input resize-none",placeholder:"Brief summary of the article"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Content *"}),e.jsx("textarea",{name:"content",value:s.content,onChange:i,rows:12,className:`input resize-none font-mono text-sm ${o.content?"border-red-500":""}`,placeholder:"Write the article content (HTML supported)"}),o.content&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.content})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-xl shadow-soft p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-white mb-4",children:"Arabic Content (العربية)"}),e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"العنوان"}),e.jsx("input",{type:"text",name:"title_ar",value:s.title_ar,onChange:i,className:"input",placeholder:"أدخل عنوان المقال"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"الملخص"}),e.jsx("textarea",{name:"excerpt_ar",value:s.excerpt_ar,onChange:i,rows:3,className:"input resize-none",placeholder:"ملخص موجز عن المقال"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"المحتوى"}),e.jsx("textarea",{name:"content_ar",value:s.content_ar,onChange:i,rows:12,className:"input resize-none font-mono text-sm",placeholder:"اكتب محتوى المقال (يدعم HTML)"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-xl shadow-soft p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-white mb-4",children:"SEO Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"SEO Title"}),e.jsx("input",{type:"text",name:"seo_title",value:s.seo_title,onChange:i,className:"input",placeholder:"Custom title for search engines"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"SEO Description"}),e.jsx("textarea",{name:"seo_description",value:s.seo_description,onChange:i,rows:3,className:"input resize-none",placeholder:"Meta description for search engines"})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-xl shadow-soft p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-white mb-4",children:"Publish Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Slug *"}),e.jsx("input",{type:"text",name:"slug",value:s.slug,onChange:i,className:`input ${o.slug?"border-red-500":""}`,placeholder:"article-slug"}),o.slug&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.slug})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Publish Date"}),e.jsx("input",{type:"date",name:"published_at",value:s.published_at,onChange:i,className:"input"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"is_published",name:"is_published",checked:s.is_published,onChange:i,className:"w-4 h-4 text-primary-600 border-neutral-300 rounded focus:ring-primary-500"}),e.jsx("label",{htmlFor:"is_published",className:"text-sm text-neutral-700 dark:text-neutral-300",children:"Published"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"is_featured",name:"is_featured",checked:s.is_featured,onChange:i,className:"w-4 h-4 text-primary-600 border-neutral-300 rounded focus:ring-primary-500"}),e.jsx("label",{htmlFor:"is_featured",className:"text-sm text-neutral-700 dark:text-neutral-300",children:"Featured"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-xl shadow-soft p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-white mb-4",children:"Organization"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Category"}),e.jsx("input",{type:"text",name:"category",value:s.category,onChange:i,className:"input",placeholder:"e.g., Company News"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1",children:"Tags"}),e.jsx("input",{type:"text",name:"tags",value:s.tags,onChange:i,className:"input",placeholder:"Comma separated tags"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-xl shadow-soft p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-white mb-4",children:"Featured Image"}),e.jsxs("div",{className:"space-y-4",children:[s.featured_image?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:I(s.featured_image)||s.featured_image,alt:"Featured",className:"w-full h-48 object-cover rounded-lg",onError:a=>{const t=a.target;t.src.includes(s.featured_image)||(t.src=s.featured_image)}}),e.jsx("button",{type:"button",onClick:L,className:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",title:"Remove image",children:e.jsx(P,{className:"w-4 h-4"})})]}):e.jsxs("div",{onDragOver:O,onDragLeave:G,onDrop:$,className:`relative w-full h-48 border-2 border-dashed rounded-lg flex flex-col items-center justify-center cursor-pointer transition-colors ${k?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-neutral-300 dark:border-neutral-600 hover:border-primary-400 dark:hover:border-primary-500"} ${h?"opacity-50 pointer-events-none":""}`,children:[e.jsx("input",{type:"file",accept:"image/*",onChange:U,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:h}),h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-8 h-8 border-2 border-primary-600 border-t-transparent rounded-full animate-spin mb-2"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-12 h-12 text-neutral-400 mb-2"}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 font-medium",children:k?"Drop image here":"Drag & drop an image"}),e.jsx("p",{className:"text-xs text-neutral-400 mt-1",children:"or click to browse"}),e.jsx("p",{className:"text-xs text-neutral-400 mt-2",children:"PNG, JPG, GIF up to 5MB"})]})]}),o.featured_image&&e.jsx("p",{className:"text-red-500 text-sm",children:o.featured_image}),e.jsxs("div",{className:"pt-2 border-t border-neutral-200 dark:border-neutral-700",children:[e.jsx("p",{className:"text-xs text-neutral-500 mb-2",children:"Or enter image URL:"}),e.jsx("input",{type:"text",name:"featured_image",value:s.featured_image,onChange:i,className:"input text-sm",placeholder:"https://example.com/image.jpg"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-xl shadow-soft p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-white mb-4",children:"Gallery Images"}),e.jsxs("div",{className:"space-y-4",children:[s.gallery_images.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-3",children:s.gallery_images.map((a,t)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:I(a.image)||a.image,alt:`Gallery ${t+1}`,className:"w-full h-24 object-cover rounded-lg",onError:r=>{const l=r.target;l.src.includes(a.image)||(l.src=a.image)}}),e.jsx("button",{type:"button",onClick:()=>B(t),className:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 hover:bg-red-600 transition-all",title:"Remove image",children:e.jsx(P,{className:"w-3 h-3"})})]},t))}),e.jsxs("div",{onDragOver:T,onDragLeave:M,onDrop:R,className:`relative w-full h-32 border-2 border-dashed rounded-lg flex flex-col items-center justify-center cursor-pointer transition-colors ${F?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-neutral-300 dark:border-neutral-600 hover:border-primary-400 dark:hover:border-primary-500"} ${b?"opacity-50 pointer-events-none":""}`,children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:z,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:b}),b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-6 h-6 border-2 border-primary-600 border-t-transparent rounded-full animate-spin mb-2"}),e.jsx("p",{className:"text-xs text-neutral-500",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-8 h-8 text-neutral-400 mb-1"}),e.jsx("p",{className:"text-xs text-neutral-600 dark:text-neutral-400 font-medium",children:F?"Drop images here":"Add gallery images"}),e.jsx("p",{className:"text-xs text-neutral-400",children:"Drag & drop or click (multiple)"})]})]}),o.gallery&&e.jsx("p",{className:"text-red-500 text-sm",children:o.gallery})]})]}),e.jsx("div",{className:"bg-white dark:bg-neutral-800 rounded-xl shadow-soft p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{type:"submit",disabled:v,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Saving...":c?"Update Article":"Create Article"}),e.jsx("button",{type:"button",onClick:()=>g("/admin/news"),className:"btn-outline w-full",children:"Cancel"})]})})]})]})})]})};export{re as default};
